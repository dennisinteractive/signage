<?php

function signage_entity_update(Drupal\Core\Entity\EntityInterface $entity) {
  $dispatcher = Drupal::getContainer()->get('event_dispatcher');

  $event = new \Drupal\signage\Event\EntityEvent($entity);
  $dispatcher->dispatch(\Drupal\signage\Event\EntityEvent::UPDATE, $event);
}

/**
 * Implements hook_cron().
 */
function signage_cron() {

  $pending_service = Drupal::getContainer()->get('signage.pending.event.service');
  $num = $pending_service->numberDue();
  drupal_set_message(
    sprintf(
      'CRON Event %d',
      $num
    )
  );

  if ($item = $pending_service->claimItem()) {
    $payload = $item->data['payload'];


    drupal_set_message(
      sprintf(
        'CRON Event payload: %s ',
        json_encode($payload)
      )
    );

    $event = $item->data['event'];
    drupal_set_message(
      sprintf(
        'CRON %s for channel: %s with url: %s ',
        $event::name(),
        $event->getChannelName(),
        $event->getUrl()
      )
    );

    $pending_service->releaseItem($item);
  }

}
